---
title: "DS 6372 Project 1"
output: html_document
---

# Data Prep

Load the necessary packages
```{r}
library(tidyverse)
library(janitor)
library(naniar)
library(leaps)
library(olsrr)
library(caret)
```

Read in the data, clean variable names
```{r}
cars <- clean_names(read_csv('https://raw.githubusercontent.com/hmlam1/MSDS-Projects/main/Applied%20Stats%20Project%201/Vehicle_MSRP.csv', show_col_types=F))
```

Check for missing values for each variable: engine_hp (69), engine_cylinders (30), number_of_doors (6), engine_fuel_type (3)
```{r}
miss_var_summary(cars)
```
Replaced number_of_doors with actual value
```{r}
cars <- cars %>% mutate(number_of_doors = ifelse(make == 'Tesla' & model == 'Model S' & year == 2016,4, ifelse(make == 'Ferrari' & model == 'FF' & year == 2013,2,number_of_doors)))
```
Replaced missing value of engine_cylinders to 0 for electric cars, removed 20 missing values for rotary engine
```{r}
cars <- cars %>% mutate(engine_cylinders = ifelse(engine_fuel_type == 'electric', 0, engine_cylinders)) %>% filter(!is.na(engine_cylinders))
```
Replaced missing value of Suzuki Verona (engine_cylinders, engine_fuel)
```{r}
cars <- cars %>% mutate(engine_cylinders = ifelse(model == 'Verona', 6, engine_cylinders), engine_fuel_type = ifelse(model  == 'Verona', 'regular unleaded', engine_fuel_type))
```
Replace engine_hp with value, remove the last 3 obs
```{r}
cars <- cars %>% mutate(engine_hp = ifelse(model == '500e', 111, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Continental' & make == 'Lincoln', 350, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Escape' & make == 'Ford', 206, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Fit EV' & make == 'Honda', 120, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Focus' & make == 'Ford', 143, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Freestar' & make == 'Ford', 195, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Impala' & make == 'Chevrolet', 196, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Leaf' & make == 'Nissan', 107, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'MKZ' & make == 'Lincoln', 188, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Model S' & make == 'Tesla', 400, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'RAV4 EV' & make == 'Toyota', 154, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Soul EV' & make == 'Kia', 109, engine_hp))
cars <- cars %>% filter(!is.na(engine_hp))
```
Confirm that there are zero NA values
```{r}
sum(as.numeric(is.na.data.frame(cars)))
```
Filtered observations where msrp is between 2001-150000, year after 2000, replace highway_mpg with real value
```{r}
cars <- cars %>% filter(msrp != 2000 & msrp < 150000 & year >= 2001) %>% mutate(highway_mpg = ifelse(highway_mpg == 354, 34, highway_mpg))
# filter further cars <- cars %>% filter(!(year<=2010 & msrp>= 100000))
```
set relevant variables as factors
```{r}
factor_vars <- c("make", "model", "engine_fuel_type", "engine_cylinders", "transmission_type", "driven_wheels", "number_of_doors", "market_category", "vehicle_size", "vehicle_style")
cars[factor_vars] <- lapply(cars[factor_vars], factor)
```
Study the data: 16 variables, 9824 observations
```{r}
str(cars)
summary(cars)
```
# EDA

## Numerical variables

6 total. All except popularity (and maybe year) need to be transformed in some way.

Correlation pattern. Engine_hp with highest corr (.797) and popularity with lowest (0.0222)
```{r}
i1 <- sapply(cars, is.numeric)
y1 <- 'msrp'
x1 <- setdiff(names(cars)[i1], y1)
cor(cars[x1], cars[[y1]])
```
visual representation of correlation matrix
```{r}
num_corr <- cor(cars[x1], cars[[y1]])
cnames <- c('year', 'engine_hp', 'highway_mpg', 'city_mpg', 'popularity')
num_corr <- cbind(num_corr, cnames) %>% as.data.frame()
num_corr %>% ggplot(aes(x = cnames, y = V1, color = cnames))+geom_point()+theme_classic()+ggtitle("MSRP correlation with numeric variables")+labs(x = "Numeric Variables", y = 'Correlation')+theme(legend.position='none')
```

msrp. numerical. log transform
```{r}
cars %>% ggplot(aes(x=msrp)) + geom_histogram(bins=20)
```
msrp vs. popularity. 

Popularity is a weird variable. Score is set by brand rather than model. And Ford has the highest pop score by far, but certainly not the highest msrp, so I suspect this var won't be used for predicting msrp.
```{r}
cars %>% ggplot(aes(x=popularity, y=msrp)) + geom_point()
# could be categorical, set as factor bc each car's make shares the same value.
```
msrp vs. highway_mpg. Require transformation
```{r}
cars %>% ggplot(aes(x=highway_mpg, y=msrp)) + geom_point() + geom_smooth(method='lm')
cars %>% ggplot(aes(x=highway_mpg, y=msrp)) + geom_point() + geom_smooth(method='loess')
# remove obs above 60 mpg?
```
msrp vs. city_mpg. Require transformation
```{r}
cars %>% ggplot(aes(x=city_mpg, y=msrp)) + geom_point()
```
msrp vs. year. 
```{r}
cars %>% ggplot(aes(x=year, y=msrp)) + geom_point()
```
msrp vs. engine_hp. Requires transformation
```{r}
cars %>% ggplot(aes(x=engine_hp, y=msrp)) + geom_point()
```

## Categorical variables

Correlation of categorical variables 
```{r warning=FALSE}
# caution: code takes a hot min to run
hetcor(cars$msrp, cars$engine_fuel_type, cars$model, cars$make, cars$engine_cylinders, cars$transmission_type, cars$driven_wheels, cars$number_of_doors, cars$market_category, cars$vehicle_size, cars$vehicle_style)
```
msrp vs. make. did not plot model bc unreadable
```{r}
cars %>% ggplot(aes(x=make, y=msrp)) + geom_boxplot()
```
msrp vs market_category
```{r}
cars %>% select(msrp, market_category) %>%
  ggplot(aes(x = msrp, fill=market_category))+
  geom_histogram()+theme(legend.position='none')

# boxplot
cars %>% ggplot(aes(x=market_category, y=msrp)) + geom_boxplot()
```

```{r}
mc_levels <- cars %>% select(msrp, market_category) %>%
  group_by(market_category) %>% summarize(mean(msrp)) %>% arrange(desc(`mean(msrp)`))

cars$market_category <- factor(cars$market_category, ordered = TRUE, levels = mc_levels$market_category)

summary(cars$market_category)
```
msrp vs. engine_cylinders.
```{r}
# ordered levels
ec_levels <- cars %>% select(msrp, engine_cylinders) %>%
  group_by(engine_cylinders) %>% summarize(mean(msrp)) %>% arrange(desc(`mean(msrp)`))

cars$engine_cylinders <- factor(cars$engine_cylinders, ordered=TRUE, levels=ec_levels$engine_cylinders)

# boxplot
cars %>% ggplot(aes(x=engine_cylinders, y=msrp)) + geom_boxplot()
```
msrp vs. engine_fuel_type
```{r}
cars %>% ggplot(aes(x=engine_fuel_type, y=msrp)) + geom_boxplot()
```
msrp vs. transmisssion_type
```{r}
tt_levels <- cars %>% select(msrp, transmission_type) %>%
  group_by(transmission_type) %>% summarize(mean(msrp)) %>% arrange(desc(`mean(msrp)`))

cars$transmission_type <- factor(cars$transmission_type, ordered=TRUE, levels=tt_levels$transmission_type)
# boxplot
cars %>% ggplot(aes(y = msrp, fill = transmission_type))+geom_boxplot()

```
msrp vs. driven_wheels
```{r}
cars %>% ggplot(aes(x=driven_wheels, y=msrp)) + geom_boxplot()
```
msrp vs. vehicle_style
```{r}
vs_levels <- cars %>% select(msrp, vehicle_style) %>%
  group_by(vehicle_style) %>% summarize(median(msrp)) %>% arrange(desc(`median(msrp)`))

cars$vehicle_style <- factor(cars$vehicle_style, ordered=TRUE, levels=vs_levels$vehicle_style)
# boxplot
cars %>% ggplot(aes(y = msrp, fill = vehicle_style))+geom_boxplot()
```
msrp vs. vehicle_size
```{r}
cars %>% ggplot(aes(x=vehicle_size, y=msrp)) + geom_boxplot()
```
msrp vs. number_of_doors
```{r}
cars %>% ggplot(aes(x=number_of_doors, y=msrp)) + geom_boxplot()
```


# Objective 1 Analysis
```{r}
set.seed(7)
```
--

# Objective 2 Analysis
```{r}

```

