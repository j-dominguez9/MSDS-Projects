---
title: "DS 6372 Project 1"
output: html_document
---

# Data Prep

Load the necessary packages
```{r}
library(tidyverse)
library(janitor)
library(naniar)
library(polycor)
library(cowplot)
library(leaps)
library(olsrr)
library(caret)
```
Read in the data, clean variable names
```{r}
cars <- clean_names(read_csv('https://raw.githubusercontent.com/hmlam1/MSDS-Projects/main/Applied%20Stats%20Project%201/Vehicle_MSRP.csv', show_col_types=F))
```
Raw data prior to cleaning: 16 variables, 11914 observations
```{r}
dim(cars)
```
Check for missing values for each variable: engine_hp (69), engine_cylinders (30), number_of_doors (6), engine_fuel_type (3)
```{r}
miss_var_summary(cars)
```
Replace number_of_doors with actual value, replace highway_mpg with real value
```{r}
cars <- cars %>% mutate(number_of_doors = ifelse(make == 'Tesla' & model == 'Model S' & year == 2016,4, ifelse(make == 'Ferrari' & model == 'FF' & year == 2013,2,number_of_doors)), highway_mpg = ifelse(highway_mpg == 354, 34, highway_mpg))
```
Replace missing value of engine_cylinders to 0 for electric cars, remove 20 missing values for rotary engine
```{r}
cars <- cars %>% mutate(engine_cylinders = ifelse(engine_fuel_type == 'electric', 0, engine_cylinders)) %>% filter(!is.na(engine_cylinders))
```
Replace missing value of Suzuki Verona (engine_cylinders, engine_fuel)
```{r}
cars <- cars %>% mutate(engine_cylinders = ifelse(model == 'Verona', 6, engine_cylinders), engine_fuel_type = ifelse(model  == 'Verona', 'regular unleaded', engine_fuel_type))
```
Replace engine_hp with value, remove the last 3 obs
```{r}
cars <- cars %>% mutate(engine_hp = ifelse(model == '500e', 111, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Continental' & make == 'Lincoln', 350, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Escape' & make == 'Ford', 206, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Fit EV' & make == 'Honda', 120, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Focus' & make == 'Ford', 143, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Freestar' & make == 'Ford', 195, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Impala' & make == 'Chevrolet', 196, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Leaf' & make == 'Nissan', 107, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'MKZ' & make == 'Lincoln', 188, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Model S' & make == 'Tesla', 400, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'RAV4 EV' & make == 'Toyota', 154, engine_hp))
cars <- cars %>% mutate(engine_hp = ifelse(model == 'Soul EV' & make == 'Kia', 109, engine_hp))
cars <- cars %>% filter(!is.na(engine_hp))
```
Confirm that there are zero NA values
```{r}
sum(as.numeric(is.na.data.frame(cars)))
```
Filter observations where msrp is between 2001-150000, year after 2000
```{r}
cars <- cars %>% filter(msrp != 2000 & msrp < 150000 & year >= 2001)
# filter further cars <- cars %>% filter(!(year<=2010 & msrp>= 100000))
```
set relevant variables as factors
```{r}
factor_vars <- c("make", "model", "engine_fuel_type", "engine_cylinders", "transmission_type", "driven_wheels", "number_of_doors", "market_category", "vehicle_size", "vehicle_style")
cars[factor_vars] <- lapply(cars[factor_vars], factor)
```
Study the data: 16 variables, 9824 observations
```{r}
str(cars)
summary(cars)
```
# EDA

## Numerical variables

6 total. All except popularity (and maybe year) need to be transformed in some way.

Correlation pattern. Engine_hp with highest corr (.797) and popularity with lowest (0.0222)
```{r}
i1 <- sapply(cars, is.numeric)
y1 <- 'msrp'
x1 <- setdiff(names(cars)[i1], y1)
cor(cars[x1], cars[[y1]])
```
visual representation of correlation matrix
```{r}
num_corr <- cor(cars[x1], cars[[y1]])
cnames <- c('year', 'engine_hp', 'highway_mpg', 'city_mpg', 'popularity')
num_corr <- cbind(num_corr, cnames) %>% as.data.frame()
num_corr %>% ggplot(aes(x = cnames, y = V1, color = cnames))+geom_point()+theme_classic()+ggtitle("MSRP correlation with numeric variables")+labs(x = "Numeric Variables", y = 'Correlation')+theme(legend.position='none')
```
Plot numerical variables
```{r}
# msrp. log transform
p1 <- cars %>% ggplot(aes(x=msrp)) + geom_histogram(bins=20)

# msrp vs. year. 
p2 <- cars %>% ggplot(aes(x=year, y=msrp)) + geom_point()

# msrp vs. popularity
## Popularity is a weird variable. Score is set by brand rather than model. And Ford has the highest pop score by far, but certainly not the highest msrp, so I suspect this var won't be used for predicting msrp. can be set to categorical if necessary
p3 <- cars %>% ggplot(aes(x=popularity, y=msrp)) + geom_point()

# msrp vs. highway_mpg. Require transformation
p4 <- cars %>% ggplot(aes(x=highway_mpg, y=msrp)) + geom_point() + geom_smooth(method='lm')

# msrp vs. city_mpg. Require transformation
p5 <- cars %>% ggplot(aes(x=city_mpg, y=msrp)) + geom_point() + geom_smooth(method='lm')

# msrp vs. engine_hp. Requires transformation
p6 <- cars %>% ggplot(aes(x=engine_hp, y=msrp)) + geom_point() + geom_smooth(method='lm')

# PLOT
plot_grid(p1, p2, p3, p4, p5, p6)
```

## Categorical variables

Correlation of categorical variables 
```{r warning=FALSE}
# caution: code takes a hot min to run
hetcor(cars$msrp, cars$engine_fuel_type, cars$model, cars$make, cars$engine_cylinders, cars$transmission_type, cars$driven_wheels, cars$number_of_doors, cars$market_category, cars$vehicle_size, cars$vehicle_style)

### it appears market_category has the highest correlation with msrp (0.7203), followed by engine_cylinders with 0.6. Of insignificant correlation are model (.012), driven wheels(0.055) and number of doors(.1179)
```
msrp vs. make, vehicle_style, and market_category (did not plot msrp vs. model bc unreadable at 65 levels)
```{r}
# msrp vs. make
p7 <- cars %>% ggplot(aes(x=make, y=msrp)) + geom_boxplot()

# msrp vs. vehicle_style
vs_levels <- cars %>% select(msrp, vehicle_style) %>%
  group_by(vehicle_style) %>% summarize(median(msrp)) %>% arrange(desc(`median(msrp)`))

cars$vehicle_style <- factor(cars$vehicle_style, ordered=TRUE, levels=vs_levels$vehicle_style)

p8 <- cars %>% ggplot(aes(y = msrp, fill = vehicle_style))+geom_boxplot()

# msrp vs market_category

cars %>% select(msrp, market_category) %>%
  ggplot(aes(x = msrp, fill=market_category))+
  geom_histogram()+theme(legend.position='none')

# boxplot
cars %>% ggplot(aes(x=market_category, y=msrp)) + geom_boxplot()

# PLOT ALL
plot_grid(p7, p8, p9, nrow = 3)
```

```{r}
mc_levels <- cars %>% select(msrp, market_category) %>%
  group_by(market_category) %>% summarize(mean(msrp)) %>% arrange((`mean(msrp)`))

cars$market_category <- factor(cars$market_category, ordered = TRUE, levels = mc_levels$market_category)

summary(cars$market_category)
```

Plotting rest of the categorical variables together
```{r}
# msrp vs. engine_cylinders
# ordered levels
ec_levels <- cars %>% select(msrp, engine_cylinders) %>%
  group_by(engine_cylinders) %>% summarize(mean(msrp)) %>% arrange((`mean(msrp)`))

cars$engine_cylinders <- factor(cars$engine_cylinders, ordered=TRUE, levels=ec_levels$engine_cylinders)

p10 <- cars %>% ggplot(aes(x=engine_cylinders, y=msrp)) + geom_boxplot()

## msrp vs. engine_fuel_type
p11 <- cars %>% ggplot(aes(x=engine_fuel_type, y=msrp)) + geom_boxplot()

## msrp vs. driven_wheels
p12 <- cars %>% ggplot(aes(x=driven_wheels, y=msrp)) + geom_boxplot()


# msrp vs. transmission_type

tt_levels <- cars %>% select(msrp, transmission_type) %>%
  group_by(transmission_type) %>% summarize(mean(msrp)) %>% arrange((`mean(msrp)`))

cars$transmission_type <- factor(cars$transmission_type, ordered=TRUE, levels=tt_levels$transmission_type)

p13 <- cars %>% ggplot(aes(y = msrp, fill = transmission_type))+geom_boxplot()

# msrp vs. vehicle_size
# ordering vehicle_size
vsi_levels <- cars %>% select(msrp, vehicle_size) %>%
  group_by(vehicle_size) %>% summarize(median(msrp)) %>% arrange((`median(msrp)`))

cars$vehicle_size <- factor(cars$vehicle_size, ordered=TRUE, levels=vsi_levels$vehicle_size)

p14 <- cars %>% ggplot(aes(x=vehicle_size, y=msrp)) + geom_boxplot()

## msrp vs. number_of_doors
p15 <- cars %>% ggplot(aes(x=number_of_doors, y=msrp)) + geom_boxplot()

## PLOT ALL
plot_grid(p10, p11, p12, p13, p14, p15)
```

# Objective 1 Analysis
```{r}
set.seed(7)
```
--

# Objective 2 Analysis
```{r}

```

